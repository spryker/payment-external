{% extends template('page-layout-main') %}

{% define data = {
    breadcrumbs: _view.stepBreadcrumbs.breadcrumbs | default([]),
    title: required,
    message: required,
    quoteTransfer: required
} %}

{% set currency %}
    {% widget 'CurrencyIsoCodeWidget' only %}{% endwidget %}
{% endset %}

{% set isUserLoggedIn = is_granted('ROLE_USER') %}

{% block sidebar %}{% endblock %}

{% block header %}
    {% include organism('header') with {
        data: {
            showSearchForm: false,
            showNavigation: false
        }
    } only %}
{% endblock %}

{% block footer %}{% endblock %}

{% block pageInfo %}{% endblock %}

{% block content %}
    <div class="box">
        <h3>{{data.title}}</h3>
        <p>{{data.message}}</p>
        {% if isUserLoggedIn %}
            <a href="{{ url('customer/overview') }}">{{ 'payment_external.go_to_my_account' | trans }}</a>
        {% endif %}
    </div>

    <section itemscope itemtype="https://schema.org/Invoice">
        <meta itemprop="identifier" content="{{ data.quoteTransfer.orderReference }}">
        <section itemprop="totalPaymentDue" itemscope itemtype="https://schema.org/PriceSpecification">
            <meta itemprop="priceCurrency" content="{{ currency | spaceless }}">
            <meta itemprop="price" content="{{ data.quoteTransfer.totals.grandTotal | moneyRaw }}">
        </section>

        <section itemprop="referencesOrder" itemscope itemtype="https://schema.org/Order">
            {% for itemTransfer in data.quoteTransfer.items %}
                <section itemprop="orderedItem" itemscope itemtype="https://schema.org/OrderItem">
                    <meta itemprop="orderQuantity" content="{{ itemTransfer.quantity }}">

                    <section itemprop="orderedItem" itemscope itemtype="https://schema.org/Product">
                        <meta itemprop="sku" content="{{ itemTransfer.sku }}">

                        <section itemprop="offers" itemscope itemtype="https://schema.org/Offer">
                            <meta itemprop="priceCurrency" content="{{ currency | spaceless }}">
                            <meta itemprop="price" content="{{ itemTransfer.sumSubtotalAggregation | moneyRaw }}">
                        </section>
                    </section>
                </section>
            {% endfor %}
        </section>
    </section>
{% endblock %}

